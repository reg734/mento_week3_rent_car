{% extends "base.html" %}
{% block content %}
<style>
    .tt-menu {
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, .15);
        z-index: 1051;
        min-width: 100%;
    }

    .tt-suggestion {
        padding: 0.5rem 1rem;
        cursor: pointer;
    }

    .tt-suggestion.tt-cursor,
    .tt-suggestion:hover {
        background: #f8f9fa;
    }

    .tt-suggestion:not(:last-child) {
        border-bottom: 1px solid #dee2e6;
    }

    .spinner-border-sm {
        width: 1rem;
        height: 1rem;
    }

    .dynamic-alert {
        margin-top: 1rem;
    }

    /* TapPay 信用卡表單樣式 */
    .tpfield {
        height: 45px;
        width: 100%;
        padding: 10px 15px;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        background-color: #fff;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    .tpfield:hover {
        border-color: #86b7fe;
    }

    .tpfield:focus-within {
        border-color: #0d6efd;
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    /* 付款狀態樣式 */
    #payment-status .alert {
        display: flex;
        align-items: center;
    }

    #payment-status .spinner-border {
        margin-right: 10px;
    }
</style>
<!-- content begin -->
<div class="no-bottom no-top zebra" id="content">
    <div id="top"></div>

    <!-- section begin -->
    <section id="subheader" class="jarallax text-light">
        <img src="{{ url_for('static', filename='images/background/subheader.jpg') }}" class="jarallax-img" alt="">
        <div class="center-y relative text-center">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 text-center">
                        <h1>Booking</h1>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </section>
    <!-- section close -->

    <section id="section-hero" aria-label="section" class="no-top mt-80 sm-mt-0">
        <div class="container">
            <div class="row align-items-center">

                <div class="col-lg-12">
                    <div class="spacer-single sm-hide"></div>
                    <div class="p-4 rounded-3 shadow-soft" data-bgcolor="#ffffff">


                        <form name="contactForm" id='contact_form'>
                            <div id="step-1" class="row">
                                <div class="col-lg-6 mb30">
                                    <h5>What is your vehicle type?</h5>

                                    <div class="de_form de_radio row g-3">
                                        <div class="radio-img col-lg-3 col-sm-3 col-6">
                                            <input id="radio-1a" name="Car_Type" type="radio" value="Hatchback"
                                                checked="checked">
                                            <label for="radio-1a"><img
                                                    src="{{ url_for('static', filename='images/select-form/car.png') }}"
                                                    alt="">Hatchback</label>
                                        </div>

                                        <div class="radio-img col-lg-3 col-sm-3 col-6">
                                            <input id="radio-1b" name="Car_Type" type="radio" value="Sedan">
                                            <label for="radio-1b"><img
                                                    src="{{ url_for('static', filename='images/select-form/car.png') }}"
                                                    alt="">Sedan</label>
                                        </div>

                                        <div class="radio-img col-lg-3 col-sm-3 col-6">
                                            <input id="radio-1c" name="Car_Type" type="radio" value="SUV">
                                            <label for="radio-1c"><img
                                                    src="{{ url_for('static', filename='images/select-form/minibus.png') }}"
                                                    alt="">SUV</label>
                                        </div>

                                        <div class="radio-img col-lg-3 col-sm-3 col-6">
                                            <input id="radio-1d" name="Car_Type" type="radio" value="All">
                                            <label for="radio-1d"><img
                                                    src="{{ url_for('static', filename='images/select-form/car.png') }}"
                                                    alt="">All</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="row">
                                        <div class="col-lg-6 mb20">
                                            <h5>Pick Up Location</h5>
                                            <div class="input-group mb-2 flex-nowrap">
                                                <input type="text" name="PickupLocation" id="autocomplete"
                                                    class="form-control" placeholder="Enter your pickup location"
                                                    autocomplete="off">
                                                <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                                    data-bs-toggle="dropdown" aria-expanded="false">
                                                    選擇地點
                                                </button>
                                                <ul class="dropdown-menu dropdown-menu-end">
                                                    <li><a class="dropdown-item" href="#">台北站</a></li>
                                                    <li><a class="dropdown-item" href="#">台中站</a></li>
                                                    <li><a class="dropdown-item" href="#">高雄站</a></li>
                                                    <!-- 其他地點 -->
                                                </ul>
                                            </div>

                                            <div class="jls-address-preview jls-address-preview--hidden">
                                                <div class="jls-address-preview__header">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-lg-6 mb20">
                                            <h5>Drop Off Location</h5>
                                            <div class="input-group mb-2 flex-nowrap">
                                                <input type="text" name="DropoffLocation" id="autocomplete2"
                                                    class="form-control" placeholder="Enter your dropoff location"
                                                    autocomplete="off">
                                                <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                                    data-bs-toggle="dropdown" aria-expanded="false">
                                                    選擇地點
                                                </button>
                                                <ul class="dropdown-menu dropdown-menu-end">
                                                    <li><a class="dropdown-item" href="#">台北站</a></li>
                                                    <li><a class="dropdown-item" href="#">台中站</a></li>
                                                    <li><a class="dropdown-item" href="#">高雄站</a></li>
                                                    <!-- 其他地點 -->
                                                </ul>
                                            </div>

                                            <div class="jls-address-preview jls-address-preview--hidden">
                                                <div class="jls-address-preview__header">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-lg-6 mb20">
                                            <h5>Pick Up Date & Time</h5>
                                            <div class="date-time-field">
                                                <input type="text" id="date-picker" name="Pick Up Date" value="">
                                                <select name="Pick Up Time" id="pickup-time">
                                                    <option selected disabled value="Select time">Time</option>
                                                    <option value="00:00">00:00</option>
                                                    <option value="00:30">00:30</option>
                                                    <option value="01:00">01:00</option>
                                                    <option value="01:30">01:30</option>
                                                    <option value="02:00">02:00</option>
                                                    <option value="02:30">02:30</option>
                                                    <option value="03:00">03:00</option>
                                                    <option value="03:30">03:30</option>
                                                    <option value="04:00">04:00</option>
                                                    <option value="04:30">04:30</option>
                                                    <option value="05:00">05:00</option>
                                                    <option value="05:30">05:30</option>
                                                    <option value="06:00">06:00</option>
                                                    <option value="06:30">06:30</option>
                                                    <option value="07:00">07:00</option>
                                                    <option value="07:30">07:30</option>
                                                    <option value="08:00">08:00</option>
                                                    <option value="08:30">08:30</option>
                                                    <option value="09:00">09:00</option>
                                                    <option value="09:30">09:30</option>
                                                    <option value="10:00">10:00</option>
                                                    <option value="10:30">10:30</option>
                                                    <option value="11:00">11:00</option>
                                                    <option value="11:30">11:30</option>
                                                    <option value="12:00">12:00</option>
                                                    <option value="12:30">12:30</option>
                                                    <option value="13:00">13:00</option>
                                                    <option value="13:30">13:30</option>
                                                    <option value="14:00">14:00</option>
                                                    <option value="14:30">14:30</option>
                                                    <option value="15:00">15:00</option>
                                                    <option value="15:30">15:30</option>
                                                    <option value="16:00">16:00</option>
                                                    <option value="16:30">16:30</option>
                                                    <option value="17:00">17:00</option>
                                                    <option value="17:30">17:30</option>
                                                    <option value="18:00">18:00</option>
                                                    <option value="18:30">18:30</option>
                                                    <option value="19:00">19:00</option>
                                                    <option value="19:30">19:30</option>
                                                    <option value="20:00">20:00</option>
                                                    <option value="20:30">20:30</option>
                                                    <option value="21:00">21:00</option>
                                                    <option value="21:30">21:30</option>
                                                    <option value="22:00">22:00</option>
                                                    <option value="22:30">22:30</option>
                                                    <option value="23:00">23:00</option>
                                                    <option value="23:30">23:30</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-lg-6 mb20">
                                            <h5>Return Date & Time</h5>
                                            <div class="date-time-field">
                                                <input type="text" id="date-picker-2" name="Collection Date" value="">
                                                <select name="Collection Time" id="collection-time">
                                                    <option selected disabled value="Select time">Time</option>
                                                    <option value="00:00">00:00</option>
                                                    <option value="00:30">00:30</option>
                                                    <option value="01:00">01:00</option>
                                                    <option value="01:30">01:30</option>
                                                    <option value="02:00">02:00</option>
                                                    <option value="02:30">02:30</option>
                                                    <option value="03:00">03:00</option>
                                                    <option value="03:30">03:30</option>
                                                    <option value="04:00">04:00</option>
                                                    <option value="04:30">04:30</option>
                                                    <option value="05:00">05:00</option>
                                                    <option value="05:30">05:30</option>
                                                    <option value="06:00">06:00</option>
                                                    <option value="06:30">06:30</option>
                                                    <option value="07:00">07:00</option>
                                                    <option value="07:30">07:30</option>
                                                    <option value="08:00">08:00</option>
                                                    <option value="08:30">08:30</option>
                                                    <option value="09:00">09:00</option>
                                                    <option value="09:30">09:30</option>
                                                    <option value="10:00">10:00</option>
                                                    <option value="10:30">10:30</option>
                                                    <option value="11:00">11:00</option>
                                                    <option value="11:30">11:30</option>
                                                    <option value="12:00">12:00</option>
                                                    <option value="12:30">12:30</option>
                                                    <option value="13:00">13:00</option>
                                                    <option value="13:30">13:30</option>
                                                    <option value="14:00">14:00</option>
                                                    <option value="14:30">14:30</option>
                                                    <option value="15:00">15:00</option>
                                                    <option value="15:30">15:30</option>
                                                    <option value="16:00">16:00</option>
                                                    <option value="16:30">16:30</option>
                                                    <option value="17:00">17:00</option>
                                                    <option value="17:30">17:30</option>
                                                    <option value="18:00">18:00</option>
                                                    <option value="18:30">18:30</option>
                                                    <option value="19:00">19:00</option>
                                                    <option value="19:30">19:30</option>
                                                    <option value="20:00">20:00</option>
                                                    <option value="20:30">20:30</option>
                                                    <option value="21:00">21:00</option>
                                                    <option value="21:30">21:30</option>
                                                    <option value="22:00">22:00</option>
                                                    <option value="22:30">22:30</option>
                                                    <option value="23:00">23:00</option>
                                                    <option value="23:30">23:30</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-12">
                                    <input type='submit' id='send_message' value='Find a Vehicle'
                                        class="btn-main pull-right">
                                </div>

                            </div>

                        </form>
                    </div>
                </div>
            </div>

            <div class="spacer-single"></div>

            <div class="row">

                <div class="col-md-3 wow fadeInRight" data-wow-delay=".2s">
                    <div class="feature-box style-4 text-center">
                        <a href="#"><i class="bg-color text-light i-boxed fa fa-car"></i></a>
                        <div class="text">
                            <a href="#">
                                <h4>Choose a vehicle</h4>
                            </a>
                            Unlock unparalleled adventures and memorable journeys with our vast fleet of vehicles
                            tailored to suit every need, taste, and destination.
                        </div>
                        <span class="wm">1</span>
                    </div>
                </div>

                <div class="col-md-3 wow fadeInRight" data-wow-delay=".4s">
                    <div class="feature-box style-4 text-center">
                        <a href="#"><i class="bg-color text-light i-boxed fa fa-calendar"></i></a>
                        <div class="text">
                            <a href="#">
                                <h4>Pick location &amp; date</h4>
                            </a>
                            Pick your ideal location and date, and let us take you on a journey filled with convenience,
                            flexibility, and unforgettable experiences.
                        </div>
                        <span class="wm">2</span>
                    </div>
                </div>

                <div class="col-md-3 wow fadeInRight" data-wow-delay=".6s">
                    <div class="feature-box style-4 text-center">
                        <a href="#"><i class="bg-color text-light i-boxed fa fa-pencil-square-o"></i></a>
                        <div class="text">
                            <a href="#">
                                <h4>Make a booking</h4>
                            </a>
                            Secure your reservation with ease, unlocking a world of possibilities and embarking on your
                            next adventure with confidence.
                        </div>
                        <span class="wm">3</span>
                    </div>
                </div>

                <div class="col-md-3 wow fadeInRight" data-wow-delay=".6s">
                    <div class="feature-box style-4 text-center">
                        <a href="#"><i class="bg-color text-light i-boxed fa fa-smile-o"></i></a>
                        <div class="text">
                            <a href="#">
                                <h4>Sit back & relax</h4>
                            </a>
                            Hassle-free convenience as we take care of every detail, allowing you to unwind and embrace
                            a journey filled comfort.
                        </div>
                        <span class="wm">3</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal -->
    <div class="modal fade" id="availableCarsModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">可出租車輛</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 內容將由 JavaScript 動態產生 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 付款 Modal (TapPay) -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">確認付款</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 訂單摘要 -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">訂單摘要</h6>
                        </div>
                        <div class="card-body" id="order-summary">
                            <!-- 動態填入訂單資訊 -->
                        </div>
                    </div>

                    <!-- 信用卡表單 -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">信用卡資訊</h6>
                        </div>
                        <div class="card-body">
                            <!-- TapPay 信用卡輸入欄位 -->
                            <div class="mb-3">
                                <label class="form-label">卡號</label>
                                <div class="tpfield" id="card-number"></div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">有效期限</label>
                                    <div class="tpfield" id="card-expiration-date"></div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">安全碼 (CVV)</label>
                                    <div class="tpfield" id="card-ccv"></div>
                                </div>
                            </div>

                            <!-- 持卡人資訊 (選擇性) -->
                            <div class="mb-3">
                                <label for="cardholder-name" class="form-label">持卡人姓名</label>
                                <input type="text" class="form-control" id="cardholder-name" placeholder="請輸入持卡人姓名">
                            </div>
                        </div>
                    </div>

                    <!-- 付款狀態提示 -->
                    <div id="payment-status" class="mt-3" style="display: none;">
                        <!-- 動態顯示付款處理狀態 -->
                    </div>

                    <!-- 測試卡號提示 (僅 Sandbox) -->
                    <div class="alert alert-info mt-3">
                        <i class="fa fa-info-circle"></i> <strong>測試模式</strong><br>
                        測試卡號：4242 4242 4242 4242<br>
                        有效期限：任何未來日期<br>
                        CVV：123
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="submit-payment" onclick="onSubmitPayment()">
                        <i class="fa fa-lock me-1"></i>確認付款
                    </button>
                </div>
            </div>
        </div>
    </div>


    <section class="text-light jarallax">
        <img src="{{ url_for('static', filename='images/select-form/car.png') }}" class="jarallax-img" alt="">
        <div class="container">
            <div class="row g-5">
                <div class="col-lg-6 wow fadeInRight">
                    <h2>We offer customers a wide range of <span class="id-color">commercial cars</span> and <span
                            class="id-color">luxury cars</span> for any occasion.</h2>
                </div>
                <div class="col-lg-6 wow fadeInLeft">
                    At our car rental agency, we believe that everyone deserves to experience the pleasure of driving a
                    reliable and comfortable vehicle, regardless of their budget. We have curated a diverse fleet of
                    well-maintained cars, ranging from sleek sedans to spacious SUVs, all at competitive prices. With
                    our streamlined rental process, you can quickly and conveniently reserve your desired vehicle.
                    Whether you need transportation for a business trip, family vacation, or simply want to enjoy a
                    weekend getaway, we have flexible rental options to accommodate your schedule.
                </div>
            </div>
            <div class="spacer-double"></div>
            <div class="row text-center">
                <div class="col-md-3 col-sm-6 mb-sm-30">
                    <div class="de_count transparent text-light wow fadeInUp">
                        <h3 class="timer" data-to="15425" data-speed="3000">0</h3>
                        Completed Orders
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-sm-30">
                    <div class="de_count transparent text-light wow fadeInUp">
                        <h3 class="timer" data-to="8745" data-speed="3000">0</h3>
                        Happy Customers
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-sm-30">
                    <div class="de_count transparent text-light wow fadeInUp">
                        <h3 class="timer" data-to="235" data-speed="3000">0</h3>
                        Vehicles Fleet
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-sm-30">
                    <div class="de_count transparent text-light wow fadeInUp">
                        <h3 class="timer" data-to="15" data-speed="3000">0</h3>
                        Years Experience
                    </div>
                </div>
            </div>
        </div>
    </section>


</div>
<!-- content close -->
{% endblock %}

{% block scripts %}
<!-- TapPay SDK (Sandbox 版本) -->
<script src="https://js.tappaysdk.com/sdk/tpdirect/v5.14.0"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/corejs-typeahead/1.3.1/typeahead.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/auto-type.js') }}"></script>
<script src="{{ url_for('static', filename='js/booking-validate.js') }}"></script>
<script src="{{ url_for('static', filename='js/booking.js') }}"></script>
<!-- TapPay 初始化設置 -->
<script>
    // 確保 DOM 載入完成後執行
    document.addEventListener('DOMContentLoaded', function () {
        // 檢查 TapPay SDK 是否載入成功
        if (typeof TPDirect !== 'undefined') {
            console.log('TapPay SDK 載入成功');

            // 取得 CSRF Token
            const csrfToken = document.querySelector('meta[name="csrf-token"]');
            const tokenValue = csrfToken ? csrfToken.content : null;

            if (!tokenValue) {
                console.error('找不到 CSRF Token，請檢查 base.html 是否有 meta[name="csrf-token"]');
                return;
            }

            // 使用 API 載入 TapPay 配置
            fetch('/api/tappay/config', {
                method: 'GET',
                headers: {
                    'X-CSRFToken': tokenValue,
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
                .then(response => {
                    console.log('API 回應狀態:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(config => {
                    console.log('API 回應:', config);

                    if (config.success) {
                        // 使用從 API 取得的配置初始化 TapPay
                        TPDirect.setupSDK(
                            config.app_id,
                            config.app_key,
                            config.environment
                        );

                        console.log('TapPay 初始化完成 (' + config.environment + ' 模式)');
                        console.log('使用 App ID:', config.app_id);

                        // 立即設置信用卡表單
                        setupCreditCardForm();
                    } else {
                        console.error('無法取得 TapPay 配置:', config.message);
                        showApiError('無法取得 TapPay 配置：' + config.message);
                    }
                })
                .catch(error => {
                    console.error('載入 TapPay 配置失敗:', error);
                    showApiError('無法連接到服務器，請檢查網路連線或聯繫系統管理員。');
                });

        } else {
            console.error('TapPay SDK 載入失敗');
            showApiError('TapPay SDK 載入失敗，請重新整理頁面。');
        }
    });

    // 顯示 API 錯誤訊息
    function showApiError(message) {
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger alert-dismissible fade show mt-3';
        alertDiv.setAttribute('role', 'alert');
        alertDiv.innerHTML = `
              <i class="fa fa-exclamation-circle me-2"></i>
              <strong>初始化失敗：</strong> ${message}
              <button type="button" class="btn-close" data-bs-dismiss="alert" 
  aria-label="Close"></button>
          `;

        // 插入到付款 Modal 的 body 中
        const modalBody = document.querySelector('#paymentModal .modal-body');
        if (modalBody) {
            modalBody.insertBefore(alertDiv, modalBody.firstChild);
        }

        // 禁用付款按鈕
        const submitButton = document.getElementById('submit-payment');
        if (submitButton) {
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fa fa-exclamation-triangle me-1"></i>服務暫時無法使用';
        }
    }

    // 設置信用卡表單
    function setupCreditCardForm() {
        // 設定外觀
        TPDirect.card.setup({
            fields: {
                number: {
                    element: '#card-number',
                    placeholder: '**** **** **** ****'
                },
                expirationDate: {
                    element: '#card-expiration-date',
                    placeholder: 'MM / YY'
                },
                ccv: {
                    element: '#card-ccv',
                    placeholder: '123'
                }
            },
            styles: {
                'input': {
                    'color': 'gray',
                    'font-size': '16px',
                    'line-height': '24px'
                },
                'input.ccv': {
                    'font-size': '16px'
                },
                ':focus': {
                    'color': 'black'
                },
                '.valid': {
                    'color': 'green'
                },
                '.invalid': {
                    'color': 'red'
                }
            },
            // 卡號輸入正確後，自動跳到下一個欄位
            isMaskCreditCardNumber: true,
            maskCreditCardNumberRange: {
                beginIndex: 6,
                endIndex: 11
            }
        });

        // 監聽輸入狀態
        TPDirect.card.onUpdate(function (update) {
            // 取得各欄位狀態
            if (update.canGetPrime) {
                // 可以取得 prime
                const submitButton = document.getElementById('submit-payment');
                if (submitButton) {
                    submitButton.disabled = false;
                }
            } else {
                // 不能取得 prime
                const submitButton = document.getElementById('submit-payment');
                if (submitButton) {
                    submitButton.disabled = true;
                }
            }

            // 顯示錯誤訊息
            if (update.hasError) {
                console.log('信用卡資訊有誤');
            }
        });

        console.log('信用卡表單設置完成');
    }

    // 提交付款
    function onSubmitPayment() {
        const tappayStatus = TPDirect.card.getTappayFieldsStatus();

        // 檢查是否可以取得 Prime
        if (!tappayStatus.canGetPrime) {
            alert('請檢查信用卡資訊');
            return;
        }

        // 顯示處理中
        showPaymentProcessing();

        // 取得 Prime
        TPDirect.card.getPrime(function (result) {
            if (result.status !== 0) {
                hidePaymentProcessing();
                alert('取得付款憑證失敗：' + result.msg);
                return;
            }

            console.log('取得 prime 成功: ', result.card.prime);

            // TODO: 將 prime 送到後端處理付款
            alert('Prime 取得成功！\nPrime: ' + result.card.prime.substring(0, 20) +
                '...');
            hidePaymentProcessing();
        });
    }

    // 顯示/隱藏處理中狀態
    function showPaymentProcessing() {
        const statusElement = document.getElementById('payment-status');
        if (statusElement) {
            statusElement.style.display = 'block';
            statusElement.innerHTML = `
                <div class="alert alert-info">
                    <div class="spinner-border spinner-border-sm" role="status"></div>
                    正在處理付款，請稍候...
                </div>
            `;
        }

        const submitButton = document.getElementById('submit-payment');
        if (submitButton) {
            submitButton.disabled = true;
        }
    }

    function hidePaymentProcessing() {
        const statusElement = document.getElementById('payment-status');
        if (statusElement) {
            statusElement.style.display = 'none';
        }

        const submitButton = document.getElementById('submit-payment');
        if (submitButton) {
            submitButton.disabled = false;
        }
    }
</script>

{% endblock %}